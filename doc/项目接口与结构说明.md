# 博客系统后端接口与结构说明

## 1. 项目结构与分层

- **controller**：接收前端请求、参数校验、调用 service、返回统一响应。
- **service**：封装业务逻辑，处理数据、权限、流程控制，调用 repository。
- **repository**：数据访问层，负责与数据库交互（JPA/Mapper）。
- **model**：实体类，映射数据库表结构。
- **dto**：数据传输对象，前后端交互的数据结构。
- **mapper**：实体与 DTO 互转。
- **common**：通用工具、统一响应、异常处理、JWT 工具等。
- **config**：安全配置等。

## 2. 层次间联系与解耦

- controller 只依赖 service 和 dto，完全不涉及数据库和实体。
- service 只依赖 repository、model、dto、mapper，业务逻辑集中，便于测试和维护。
- repository 只负责数据持久化，接口化，便于替换和单元测试。
- dto/mapper 负责数据结构转换，避免实体泄漏到 controller 层。
- common 层提供统一响应、异常处理、工具类，所有层可复用。
- config 层集中管理安全、跨域等配置。

## 3. 所有接口设计

### 博客相关（BlogPostController）
| 方法 | 路径 | 说明 | 请求体/参数 | 返回 |
|------|------|------|-------------|------|
| POST | /api/blogpost | 创建博客 | BlogPostCreateDTO | ApiResponse<Long> |
| GET | /api/blogpost/{id} | 获取单篇博客详情 | id | ApiResponse<BlogPostDTO> |
| GET | /api/blogpost | 分页获取博客列表 | page, size, currentUserId | ApiResponse<List<BlogPostDTO>> |
| POST | /api/blogpost/{id}/like | 点赞/取消点赞 | id, userId | ApiResponse<Boolean> |
| POST | /api/blogpost/comment | 发表评论 | CommentCreateDTO | ApiResponse<Long> |
| GET | /api/blogpost/{id}/comments | 获取博客评论列表 | id, currentUserId | ApiResponse<List<CommentDTO>> |
| POST | /api/blogpost/comment/{id}/like | 评论点赞/取消点赞 | id, userId | ApiResponse<Boolean> |
| POST | /api/blogpost/repost | 转发博客 | RepostCreateDTO | ApiResponse<Long> |
| PUT | /api/blogpost/{id} | 更新博客 | id, BlogPostUpdateDTO | ApiResponse<Boolean> |

### 用户相关（UserController）
| 方法 | 路径 | 说明 | 请求体/参数 | 返回 |
|------|------|------|-------------|------|
| POST | /api/user/register | 用户注册 | UserRegisterDTO | ApiResponse<Void> |
| POST | /api/user/login | 用户登录 | UserLoginDTO | ApiResponse<LoginResponseDTO> |
| GET | /api/user/profile/{userId} | 获取用户资料 | userId | ApiResponse<UserProfileDTO> |
| PUT | /api/user/profile/{userId} | 更新用户资料 | userId, UserProfileDTO | ApiResponse<Void> |

### 评论相关（CommentController）
| 方法 | 路径 | 说明 | 请求体/参数 | 返回 |
|------|------|------|-------------|------|
| POST | /api/comment | 新增评论 | CommentCreateDTO | ApiResponse<Long> |
| GET | /api/comment/list/{blogPostId} | 获取某博客下评论列表 | blogPostId, currentUserId | ApiResponse<List<CommentDTO>> |
| DELETE | /api/comment/{commentId} | 删除评论 | commentId, userId | ApiResponse<Boolean> |
| POST | /api/comment/{commentId}/like | 点赞/取消点赞评论 | commentId, userId | ApiResponse<Boolean> |

## 4. 前后端数据传递格式（DTO/VO）

### BlogPostCreateDTO
```json
{
  "title": "string",
  "content": "string",
  "authorId": 1
}
```

### BlogPostDTO
```json
{
  "id": 1,
  "title": "string",
  "content": "string",
  "author": "string",
  "likeCount": 10,
  "commentCount": 5,
  "createdAt": "2025-11-27T12:00:00Z"
}
```

### BlogPostUpdateDTO
```json
{
  "title": "string",
  "content": "string"
}
```

### CommentCreateDTO
```json
{
  "blogPostId": 1,
  "content": "string",
  "userId": 2
}
```

### CommentDTO
```json
{
  "id": 1,
  "blogPostId": 1,
  "content": "string",
  "userId": 2,
  "likeCount": 3,
  "createdAt": "2025-11-27T12:00:00Z"
}
```

### UserRegisterDTO
```json
{
  "username": "string",
  "password": "string",
  "gender": "男/女"
}
```

### UserLoginDTO
```json
{
  "username": "string",
  "password": "string"
}
```

### LoginResponseDTO
```json
{
  "token": "jwt-token-string",
  "userId": 1,
  "username": "string"
}
```

### UserProfileDTO
```json
{
  "userId": 1,
  "nickname": "string",
  "avatar": "url",
  "background": "url",
  "gender": "男/女"
}
```

### RepostCreateDTO
```json
{
  "blogPostId": 1,
  "userId": 2,
  "content": "string"
}
```

## 5. 统一响应结构（ApiResponse）

所有接口返回如下结构：
```json
{
  "code": 200,
  "msg": "操作成功",
  "data": "具体DTO对象或null"
}
```

## 6. 异常与统一响应
- 全局异常由 GlobalExceptionHandler 统一处理，返回 ApiResponse 格式。
- 业务异常抛出 BusinessException，参数校验失败自动返回 400。
- 未知异常返回 500，避免敏感信息泄漏。

## 7. service 和 controller 层工作原理

- controller 只负责接收请求、参数校验、调用 service、返回 ApiResponse。
- service 封装所有业务逻辑，如数据校验、权限判断、流程控制、DTO/实体转换。
- controller 不直接操作数据库、不处理业务逻辑，保证解耦和可维护性。
- service 只与 repository、mapper、dto 交互，便于单元测试和业务扩展。
- 通过抛出 BusinessException 统一异常处理。

---

如需进一步查看某层实现细节或代码片段，可查阅对应 Java 文件。
