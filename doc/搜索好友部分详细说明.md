# 搜索好友部分详细说明

本说明文档详细分析本项目后端关于“搜索好友”相关功能的实现机制，涵盖通信流程、文件间交互、前后端链路、全局异常处理与ApiResponse统一格式、各层次功能与通信过程。内容参考了《关注部分详细说明》《用户资料部分详细说明》《登录注册部分详细说明》，并结合实际代码实现。

---

## 1. 通信流程与前后端链接

### 1.1 搜索好友流程
- **前端**向`/api/users/search`发送GET请求，参数为`username`或`nickname`（可选，模糊搜索）。
- **后端**`UserSearchController`接收请求，校验参数，调用`UserSearchService`执行业务。
- Service层调用`UserRepository`联合`UserProfile`进行数据库模糊查询。
- 查询结果通过`UserSearchMapper`转换为DTO，封装为`ApiResponse<List<UserSearchDTO>>`返回。
- 成功返回code为200，msg为“OK”，data为用户简要信息列表；参数缺失或异常返回相应错误码和提示。

---

## 2. 文件间交互与各层功能

### 2.1 Controller层
- 负责接收前端请求、参数校验、调用Service层、返回统一响应。
- 主要文件：`UserSearchController.java`
  - 负责`/api/users/search`接口的路由与响应。

### 2.2 Service层
- 负责搜索好友的业务逻辑，调用Repository层联合查询。
- 主要文件：`UserSearchService.java`、`UserSearchServiceImpl.java`
  - `searchByUsernameWithProfile(username)`：按用户名模糊搜索。
  - `searchByNicknameWithProfile(nickname)`：按昵称模糊搜索。

### 2.3 Repository层
- 负责用户与用户资料的联合模糊查询。
- 主要文件：`UserRepository.java`
  - `searchByUsernameWithProfile(username)`：联合UserProfile按用户名模糊查询。
  - `searchByNicknameWithProfile(nickname)`：联合UserProfile按昵称模糊查询。

### 2.4 DTO与Mapper层
- 用于数据传输和实体转换。
- 主要文件：
  - `UserSearchDTO.java`：搜索结果的用户简要信息结构。
  - `UserSearchMapper.java`：User+UserProfile转DTO。

### 2.5 Model层
- 主要文件：
  - `User.java`：用户实体。
  - `UserProfile.java`：用户资料实体。

### 2.6 Common层
- 提供统一响应、异常处理。
- 主要文件：
  - `ApiResponse.java`：统一API响应格式。
  - `BusinessException.java`、`GlobalExceptionHandler.java`：全局异常处理。

---

## 3. 统一API响应格式（ApiResponse）
- 所有接口返回`ApiResponse<T>`对象，包含：
  - `code`：状态码（如200、400等）
  - `msg`：提示信息
  - `data`：返回数据（如用户列表）

---

## 4. 主要功能与流程时序图

```
前端请求
   ↓
UserSearchController
   ↓
UserSearchService
   ↓
UserRepository（联合查询User和UserProfile）
   ↓
UserSearchServiceImpl
   ↓
UserSearchMapper（实体转DTO）
   ↓
UserSearchController（封装ApiResponse）
   ↓
前端响应
```

---

## 5. 扩展性与安全性说明
- 可根据业务需求，灵活扩展DTO字段或查询条件。
- 支持后续与关注、好友等社交关系的深度集成。
- 采用分层设计，便于维护和单元测试。
- DTO只暴露必要字段，防止敏感信息泄漏。
- 所有参数校验、业务异常均有统一处理，保证接口健壮性。

---

## 6. 与其他模块关系
- 可与“关注”、“私信”等社交模块联动，作为用户互动入口。
- 用户资料展示与编辑可复用UserProfile相关结构。
- 搜索结果可作为添加好友、发起私信等操作的入口。

---

如需进一步扩展或定制搜索逻辑，可在Service和Repository层灵活调整。
