# 登录注册模块详细说明

本说明文档基于当前后端实现，全面梳理用户登录与注册相关功能、接口、数据结构、分层设计、参数校验、异常处理等。

---

## 1. 业务逻辑与结构

- 支持用户注册、登录，参数校验严格。
- 注册时校验用户名唯一、格式合法，密码强度。
- 登录时校验用户名、密码，返回 JWT 令牌及用户信息。
- 所有接口返回统一响应结构，异常友好提示。

---

## 2. 主要实体与DTO结构

### 2.1 User 实体
- id: Long
- username: String
- password: String
- gender: String

### 2.2 UserRegisterDTO
```json
{
  "username": "string",
  "password": "string",
  "gender": "男/女/保密"
}
```

### 2.3 UserLoginDTO
```json
{
  "username": "string",
  "password": "string"
}
```

### 2.4 LoginResponseDTO
```json
{
  "token": "jwt-token-string",
  "userId": 1,
  "nickname": "昵称",
  "avatarUrl": "头像URL",
  "backgroundUrl": "背景URL",
  "gender": "男/女"
}
```

---

## 3. 主要接口设计（UserController）

| 方法 | 路径 | 说明 | 请求体/参数 | 返回 |
|------|------|------|-------------|------|
| POST | /api/user/register | 用户注册 | UserRegisterDTO | ApiResponse<Void> |
| POST | /api/user/login | 用户登录 | UserLoginDTO | ApiResponse<LoginResponseDTO> |

---

## 4. Service 层接口

```java
public interface UserService {
    void register(UserRegisterDTO dto);
    LoginResponseDTO login(UserLoginDTO dto);
}
```

---

## 5. 主要实现逻辑说明
- **register**：校验用户名、密码格式，用户名唯一，密码加密存储。
- **login**：校验用户名、密码，生成 JWT，返回用户资料。

---

## 6. Controller 典型代码片段

```java
@RestController
@RequestMapping("/api/user")
public class UserController {
    @Autowired
    private UserService userService;

    @PostMapping("/register")
    public ApiResponse<Void> register(@RequestBody @Valid UserRegisterDTO userRegisterDTO) {
        userService.register(userRegisterDTO);
        return new ApiResponse<>(200, "注册成功", null);
    }

    @PostMapping("/login")
    public ApiResponse<LoginResponseDTO> login(@RequestBody @Valid UserLoginDTO userLoginDTO) {
        LoginResponseDTO resp = userService.login(userLoginDTO);
        return new ApiResponse<>(200, "登录成功", resp);
    }
}
```

---

## 7. 参数校验、异常处理
- 注册/登录参数均有格式校验，失败自动返回 400。
- 用户名已存在、密码错误等业务异常抛出 BusinessException，前端可友好展示。
- 所有接口返回统一 ApiResponse<T>，包含 code/msg/data。
- 全局异常由 GlobalExceptionHandler 统一处理。

---

## 8. 其他说明
- 支持后续扩展（如邮箱/手机注册、验证码、第三方登录等）。
- DTO 仅暴露必要字段，防止敏感信息泄漏。

---

如需详细代码实现，请查阅 `service/impl/UserServiceImpl.java`、`controller/UserController.java`、`model/User.java`、`dto/UserRegisterDTO.java`、`dto/UserLoginDTO.java`、`dto/LoginResponseDTO.java` 等文件。
